<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bookmark</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<!-- ‚îÄ‚îÄ Header ‚îÄ‚îÄ -->
<header>
  <div class="logo">book<span>mark</span></div>

  <div class="search-wrap">
    <form action="/" method="get">
      {% if current_tag %}
        <input type="hidden" name="tag" value="{{ current_tag }}">
      {% endif %}
      <input type="text" name="search" placeholder="„Çø„Ç§„Éà„É´„ÉªURL„ÅßÊ§úÁ¥¢‚Ä¶" value="{{ search }}">
      <button class="btn-search" type="submit">Ê§úÁ¥¢</button>
    </form>
  </div>

  <button class="btn-add-toggle" onclick="toggleAdd()">Ôºã ËøΩÂä†</button>
</header>

<!-- ‚îÄ‚îÄ Add panel ‚îÄ‚îÄ -->
<div class="add-panel" id="addPanel">
  <div class="add-panel-inner">
    <h2>Êñ∞„Åó„ÅÑ„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ</h2>
    <form action="/add" method="post">
      <div class="form-grid">
        <div class="field">
          <label>„Çø„Ç§„Éà„É´ *</label>
          <input type="text" name="title" placeholder="„Çµ„Ç§„ÉàÂêç" required>
        </div>
        <div class="field">
          <label>URL *</label>
          <input type="url" name="url" placeholder="https://example.com" required>
        </div>
        <div class="field">
          <label>„Çø„Ç∞</label>
          <input type="text" name="tag" placeholder="Tech / ‰ªï‰∫ã / Ë∂£Âë≥‚Ä¶" list="tag-suggestions">
          <datalist id="tag-suggestions">
            {% for tag in tags %}<option value="{{ tag }}">{% endfor %}
          </datalist>
        </div>
        <div class="field">
          <label>„É°„É¢</label>
          <input type="text" name="description" placeholder="‰∏ÄË®Ä„É°„É¢Ôºà‰ªªÊÑèÔºâ">
        </div>
      </div>
      <div class="form-actions">
        <button class="btn-submit" type="submit">‰øùÂ≠ò</button>
        <button class="btn-cancel" type="button" onclick="toggleAdd()">„Ç≠„É£„É≥„Çª„É´</button>
      </div>
    </form>
  </div>
</div>

<!-- ‚îÄ‚îÄ Layout ‚îÄ‚îÄ -->
<div class="layout">

  <!-- Sidebar: Tags -->
  <nav class="sidebar">
    <p class="sidebar-title">„Çø„Ç∞</p>
    <ul class="tag-list">
      <li>
        <a href="/" class="{{ 'active' if not current_tag else '' }}">„Åô„Åπ„Å¶</a>
      </li>
      {% for tag in tags %}
      <li>
        <a href="/?tag={{ tag }}" class="{{ 'active' if current_tag == tag else '' }}">{{ tag }}</a>
      </li>
      {% endfor %}
    </ul>
  </nav>

  <!-- Main -->
  <main class="main">
    <p class="stats">
      <strong>{{ bookmarks|length }}</strong> ‰ª∂
      {% if current_tag %} ‚Äî „Çø„Ç∞: <strong>{{ current_tag }}</strong>{% endif %}
      {% if search %} ‚Äî Ê§úÁ¥¢: <strong>{{ search }}</strong>{% endif %}
    </p>

    <div class="bookmark-grid">
      {% if bookmarks %}
        {% for b in bookmarks %}
        <div class="card">
          <div class="card-header">
            <img class="favicon"
                 src="https://www.google.com/s2/favicons?domain={{ b.url }}&sz=32"
                 onerror="this.style.display='none'" alt="">
            <a class="card-title" href="{{ b.url }}" target="_blank" rel="noopener">
              {{ b.title }}
            </a>
          </div>

          <div class="card-url">{{ b.url }}</div>

          {% if b.description %}
          <div class="card-desc">{{ b.description }}</div>
          {% endif %}

          <div class="card-footer">
            {% if b.tag %}
            <a class="card-tag" href="/?tag={{ b.tag }}">{{ b.tag }}</a>
            {% else %}<span></span>{% endif %}
            <span class="card-date">{{ b.created_at.strftime('%Y-%m-%d') }}</span>
          </div>

          <div class="card-actions">
            <a class="btn-icon" href="/edit/{{ b.id }}">Á∑®ÈõÜ</a>
            <form action="/delete/{{ b.id }}" method="post" style="display:inline"
                  onsubmit="return confirm('ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')">
              <button class="btn-icon danger" type="submit">ÂâäÈô§</button>
            </form>
          </div>
        </div>
        {% endfor %}
      {% else %}
        <div class="empty">
          <div class="empty-icon">üîñ</div>
          <p>„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
        </div>
      {% endif %}
    </div>
  </main>
</div>

<script src="{{ url_for('static', filename='main.js') }}"></script>
</body>
</html>
